var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{_(i.next(e))}catch(t){a(t)}}function s(e){try{_(i["throw"](e))}catch(t){a(t)}}function _(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}_((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;_;)try{if(r=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return _.label++,{value:n[1],done:!1};case 5:_.label++,a=n[1],n=[0];continue;case 7:n=_.ops.pop(),_.trys.pop();continue;default:if(o=_.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){_=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){_.label=n[1];break}if(6===n[0]&&_.label<o[1]){_.label=o[1],o=n;break}if(o&&_.label<o[2]){_.label=o[2],_.ops.push(n);break}o[2]&&_.ops.pop(),_.trys.pop();continue}n=t.call(e,_)}catch(i){n=[6,i],a=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,a,o,s,_={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Skill=function(){function e(){}return e.feed=function(){var t=Main.cfg_skill.FEED;Main.cfg_prop.HP;if(Main.pl.GOLD<t.cost)Main.msg+=t.name+"需要至少 "+t.cost+" 时间晶体！\n";else if(Main.pl.HP+t.value>=Player.get_show_HP_max())Main.msg+="运转速率较高，无需"+t.name+"。\n";else{var n=Player.get_show_HP_max()-Main.pl.HP,i=e.get_and_cost(t,n);Main.pl.GOLD-=i[1],Main.pl.HP+=i[0],Main.msg+="时间被扭曲，运转速率提升 "+i[0]+" ！消耗了 "+i[1]+" 时间晶体。\n",Game.save();var r=t.event_rate*i[2]/t.heap,a=this.mon_inc(r);a&&(Main.msg+=t.name+"引发了熵增，熵增加了 "+a.toFixed()+" ！\n")}return null},e.clean=function(){var t=Main.cfg_skill.CLEAN,n=Main.cfg_prop.MON;if(Main.pl.GOLD<t.cost)Main.msg+=t.name+"需要至少 "+t.cost+" 时间晶体！\n";else if(Main.pl.MON+t.value<=n.min_value)Main.msg+="熵不多，无需"+t.name+"。\n";else{var i=Main.pl.MON-n.min_value,r=e.get_and_cost(t,i);Main.pl.GOLD-=r[1],Main.pl.MON+=r[0],Main.msg+="你注入了 "+r[1]+" 时间晶体，熵降低了 "+-r[0]+" ！\n",Game.save()}return null},e.say=function(){var e=Main.cfg_skill.SAY;if(Main.pl.GOLD<e.cost)Main.msg+=e.name+"需要至少 "+e.cost+" 时间晶体！\n";else{if(!Player.is_weak()){Main.pl.GOLD-=e.cost,Main.msg+="使用 "+e.cost+" 时间晶体尝试"+e.name+"……\n",Game.save();var t=e.event_rate,n=this.mon_inc(t);n&&(Main.msg+=e.name+"引发了熵增，熵增加了 "+n.toFixed()+" ！");var i=Define.SAY_RATE;return Math.random()<=i?(Main.msg+=e.name+"成功！\n",1):(Main.msg+=e.name+"失败！\n",null)}Main.msg+="当前运转速率过低或熵过高，不适宜"+e.name+"。\n"}return null},e.mon_inc=function(e){var t=Math.random();if(e>=t){var n=(Main.pl.MON+Define.MON_INC_VALUE)*Define.MON_INC_RATIO;return Main.pl.MON+=n,Game.save(),n}return 0},e.get_and_cost=function(e,t){var n=Math.min(Math.floor(Main.pl.GOLD/e.cost),Math.floor(Math.abs(t/e.value)),e.heap);console.assert(n>0,"my_heap<=0!");var i=e.value*n,r=e.cost*n;return[i,r,n]},e}();__reflect(Skill.prototype,"Skill");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?i(r):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Game=function(){function Game(){}return Game.load_save=function(){console.log("load_save"),Main.pl=new Player,Main.pl.STATUS=parseInt(egret.localStorage.getItem("STATUS")),Main.pl.FIRST_TIME=egret.localStorage.getItem("FIRST_TIME"),Main.pl.BORN_TIME=egret.localStorage.getItem("BORN_TIME"),Main.pl.LAST_TIME=egret.localStorage.getItem("LAST_TIME"),Main.pl.HP=parseFloat(egret.localStorage.getItem("HP")),Main.pl.MON=parseFloat(egret.localStorage.getItem("MON")),Main.pl.EXP=parseFloat(egret.localStorage.getItem("EXP")),Main.pl.GOLD=parseFloat(egret.localStorage.getItem("GOLD")),Main.pl.NAME=egret.localStorage.getItem("NAME"),Main.pl.PROGRESS=parseFloat(egret.localStorage.getItem("PROGRESS")),Main.pl.DISTANCE=parseFloat(egret.localStorage.getItem("DISTANCE")),Tendency.load_all()},Game.init=function(e){console.log("init_game_data"),Main.pl=new Player,Main.pl.STATUS=PLAYER_STATUS.ALIVE,Main.pl.FIRST_TIME=egret.localStorage.getItem("FIRST_TIME")||e,egret.localStorage.setItem("FIRST_TIME",Main.pl.FIRST_TIME),Main.pl.BORN_TIME=e,Main.pl.LAST_TIME=e,Main.pl.HP=Main.cfg_prop.HP.init_value,Main.pl.MON=Main.cfg_prop.MON.init_value,Main.pl.EXP=Main.cfg_prop.EXP.init_value,Main.pl.GOLD=Main.cfg_prop.GOLD.init_value,Main.pl.NAME=Define.INIT_NAME,Main.pl.PROGRESS=0,Main.pl.DISTANCE=Define.INIT_DISTANCE,Tendency.init(),Game.save()},Game["continue"]=function(e){console.log("continue");var t=new Date(egret.localStorage.getItem("LAST_TIME")),n=e.getTime()-t.getTime();egret.localStorage.setItem("LAST_TIME",e),console.log("delta_time:",n),this.time_pass_event(n)},Game.save=function(what){if(void 0===what&&(what="all"),"all"==what){console.log("save all game data"),egret.localStorage.setItem("STATUS",String(Main.pl.STATUS)),egret.localStorage.setItem("BORN_TIME",Main.pl.BORN_TIME);var cur_time=new Date;Main.pl.LAST_TIME=String(cur_time),egret.localStorage.setItem("LAST_TIME",Main.pl.LAST_TIME),egret.localStorage.setItem("HP",String(Main.pl.HP)),egret.localStorage.setItem("MON",String(Main.pl.MON)),egret.localStorage.setItem("EXP",String(Main.pl.EXP)),egret.localStorage.setItem("GOLD",String(Main.pl.GOLD)),egret.localStorage.setItem("NAME",Main.pl.NAME),egret.localStorage.setItem("PROGRESS",String(Main.pl.PROGRESS)),egret.localStorage.setItem("DISTANCE",String(Main.pl.DISTANCE))}else{var value=String(eval("Main.pl."+what));console.log("save "+what+" , value = "+value),egret.localStorage.setItem(what,String(eval("Main.pl."+what)))}},Game.make_history=function(e){var t={BORN_TIME:String(Main.pl.BORN_TIME),DIE_TIME:String(e),EXP:Main.pl.EXP},n=this.load_history();n||(n={}),n[Main.pl.NAME]=t;var i=JSON.stringify(n);egret.localStorage.setItem("HISTORY",i)},Game.load_history=function(){var e=egret.localStorage.getItem("HISTORY");if(e){var t=JSON.parse(e);return t}return null},Game.history_textflow=function(){var e=this.load_history(),t=[];for(var n in e){var i=new Date(e[n].BORN_TIME),r=new Date(e[n].DIE_TIME),a=(GameUtils.get_delta_day(i,r),"姓名："+n+"\n");a+="出生时间："+GameUtils.get_ymd(i)+"\n",a+="死亡时间："+GameUtils.get_ymd(r)+"\n",a+="纠缠度："+GameUtils.floatstr(Tendency.to_EXP(),1)+"\n",a+="距离："+GameUtils.intstr(Main.pl.DISTANCE),t.push(a)}return t.reverse()},Game.get_progress=function(e){return void 0===e&&(e=Main.pl.DISTANCE),(Define.INIT_DISTANCE-e)/Define.DISTANCE_PROGRESS_SEPARATE},Game.time_pass_event=function(e){if(Player.is_alive()){var t=e/1e3;Player.change_props(t),Player.change_status()}this.check_ending()},Game.check_ending=function(){Main.pl.DISTANCE<=0},Game}();__reflect(Game.prototype,"Game");var GameUtils=function(){function e(){}return e.intstr=function(e){return String(Math.floor(e))},e.floatstr=function(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return String(Math.floor(e*n)/n)},e.random=function(e,t){if(e==t)return e;var n=e+Math.floor(Math.random()*(t-e));return n>=t&&(n=t-1),n},e.choice=function(e){return e[Math.floor(Math.random()*e.length)]},e.setLoopAnim=function(e){for(var t=0;t<e.items.length;t++)e.items[t].props={loop:!0};e.play()},e.setAnim0=function(e){e.stop(),e.play(),e.stop()},e.my_parse_time=function(e){var t=e/1e3/60/60;if(t>=24){var n=Math.floor(t%24),i=Math.floor(t/24);return i+"天"+n+"小时"}return t>=1?Math.floor(t)+"小时":"不足1小时"},e.get_ymd=function(e){return e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日"},e.get_delta_day=function(e,t){var n=e.getTime(),i=t.getTime(),r=i-n;return Math.floor(r/1e3/60/60/24)},e.debug_clear_data=function(){egret.localStorage.clear(),console.log("all game data cleared")},e.get_story_key=function(t){var n=Main.cfg_event,i="";if(n.hasOwnProperty(t))i=t;else if(0==t.indexOf("!r")){for(var r=e.get_num_array(Main.cfg_event,"!r"),a=0,o=r.length;o>a;a++)if(Player.get_total_exp()>=r[a]){i="!r"+String(r[a]);break}}else if(0==t.indexOf("!f"))for(var r=e.get_num_array(Main.cfg_event,"!f",!1),a=0,o=r.length;o>a;a++)if(Main.pl.PROGRESS<r[a]&&Game.get_progress()>=r[a]){i="!f"+String(r[a]),Main.pl.PROGRESS=r[a],Game.save("PROGRESS"),console.log("game progress up!");break}if(""==i)return null;var s=n[i].stories;return s[e.random(0,s.length)]},e.get_num_array=function(e,t,n){void 0===n&&(n=!0);for(var i=Object.keys(e),r=new Array,a=0,o=i.length;o>a;a++)0==i[a].indexOf(t)&&r.push(i[a].substr(t.length));for(var s=new Array,a=0,o=r.length;o>a;a++)isNaN(r[a])||s.push(r[a]);return n?s.reverse():s},e.get_console_text=function(e,t,n){void 0===t&&(t=9),void 0===n&&(n=44);for(var i=e.split("\n"),r=0,a=0,o=i.length-1;o>=0;o--){var s=this.get_char_length(i[o]);if(s){var _=Math.ceil(s/n);if(r+_>t){a=o+1;break}r+=_}}var l=i.slice(a);return l.join("\n")},e.get_char_length=function(e){if(!e)return 0;e=e.replace(/\s+/g,"");for(var t=0,n=0;n<e.length;n++)e.charCodeAt(n)>=0&&e.charCodeAt(n)<=128?t++:t+=2;return t},e}();__reflect(GameUtils.prototype,"GameUtils");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=640,this.textField.height=1136,this.textField.verticalAlign="center",this.textField.textAlign="center",this.textField.fontFamily="SimHei",this.textField.size=36,this.textField.lineSpacing=30,this.textField.bold=!0,this.textField.background=!0,this.textField.backgroundColor=0},t.prototype.onProgress=function(e,t){this.textField.text="\n\n\n\n\n双生火焰\n游人坊 出品\n\n\n加载中……"+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadResource()];case 1:return n.sent(),this.playerLoad(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=n.sent(),[4,platform.login()];case 3:return n.sent(),[4,platform.getUserInfo()];case 4:return t=n.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return i.sent(),this.stage.removeChild(e),t.cfg_prop=RES.getRes("prop_json"),t.cfg_skill=RES.getRes("skill_json"),t.cfg_story=RES.getRes("story_json"),t.cfg_event=RES.getRes("event_json"),t.cfg_tend=RES.getRes("tend_json"),[3,5];case 4:return n=i.sent(),console.error(n),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var i=new eui.Theme("resource/default.thm.json",e.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){this.addChild(new UI_Main)},t.prototype.playerLoad=function(){Game.load_save();var e=new Date;console.log("enter game at:",e),t.pl.FIRST_TIME?Game["continue"](e):(egret.localStorage.setItem("STATUS",String(PLAYER_STATUS.NOT_INITED)),Game.save(),console.log("not inited"))},t.msg="",t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var PLAYER_STATUS;!function(e){e[e.NOT_INITED=-1]="NOT_INITED",e[e.DIED=0]="DIED",e[e.DYING=1]="DYING",e[e.WEAK=2]="WEAK",e[e.ALIVE=3]="ALIVE"}(PLAYER_STATUS||(PLAYER_STATUS={}));var Player=function(){function e(){}return e.change_props=function(e){var t=Math.max(1,Main.pl.MON/Main.cfg_prop.MON.max_value);console.log("slow_ratio",t),Main.pl.HP+=Main.cfg_prop.HP.change_ps*e*t,Main.pl.HP=Math.max(Main.pl.HP,Main.cfg_prop.HP.min_value),Main.pl.MON+=Main.cfg_prop.MON.change_ps*e,Main.pl.GOLD+=Main.cfg_prop.GOLD.change_ps*e,Main.pl.DISTANCE-=this.get_real_speed()*e/60/60/24,Game.save()},e.change_status=function(){this.is_dying()?(console.log("dying!"),Main.pl.STATUS=PLAYER_STATUS.DYING,Game.save()):this.is_weak()&&(console.log("weak!"),Main.pl.STATUS=PLAYER_STATUS.WEAK,Game.save())},e.get_total_exp=function(){var e=new Date,t=new Date(Main.pl.BORN_TIME),n=GameUtils.get_delta_day(t,e);return Main.pl.EXP+n},e.is_alive=function(){return Main.pl.STATUS>=1?!0:!1},e.is_dying=function(){return Main.pl.HP<=Main.cfg_prop.HP.min_value?!0:!1},e.is_weak=function(){return this.hp_too_low()||this.mon_too_much()?!0:!1},e.hp_too_low=function(){return Main.pl.HP<=this.get_show_HP_max()*Define.DYING_PERCENT?!0:!1},e.mon_too_much=function(){return Main.pl.MON>=Main.cfg_prop.MON.max_value?!0:!1},e.can_skip=function(){return!1},e.get_real_speed=function(){var e,t=Tendency.to_EXP()*Define.SPEED_PER_EXP,n=Main.cfg_prop.HP.init_value;return e=n+t},e.get_show_HP_max=function(){return Math.max(this.get_real_speed(),Main.cfg_prop.HP.max_value)},e}();__reflect(Player.prototype,"Player");var Define=function(){function e(){}return e.MSG_CONNECT_OK="连接建立成功！\n",e.MSG_CONNECTED_ALREADY="刷新成功！已建立连接：",e.MSG_DISCONNECTED="已断开连接……\n",e.MSG_ALMOST_DISCONNECTED="仪器已无法正常工作……\n",e.MSG_HP_TOO_LOW="请及时提升运转速率！\n",e.MSG_MON_TOO_MUCH="请及时清理熵！\n",e.MSG_SUFFIX="！\n",e.MSG_NAME_CHANGED_TO="姓名变更为",e.MSG_NEW_TEND_UNLOCKED="新的特征解锁了",e.ERR_NAME_TOO_LONG="名字太长了！",e.LINK_MAIN_PAGE="http://gamefang.xyz/",e.ERR_NO_HISTORY="暂无历史记录！",e.TEND_NAMES=["MF","NC","FS","RI","SR","VT","EG","HD"],e.INIT_NAME="双生火焰",e.SAY_RATE=.5,e.MON_INC_RATIO=.2,e.MON_INC_VALUE=1634,e.DYING_PERCENT=.5,e.SKIP_GOLD=10,e.BEGIN_SKIP_EXP=3,e.INIT_DISTANCE=6174,e.EXP_PER_TEND=.1,e.SPEED_PER_EXP=100,e.MSGBOX_CHAR_LENGTH=44,e.TEND_STR="特征：",e.UNLOCK_TEND_STR=e.TEND_STR+"???",e.DISTANCE_PROGRESS_SEPARATE=514.5,e}();__reflect(Define.prototype,"Define");var Tendency=function(){function e(){}return e.my_generate=function(){var e={};e[Define.TEND_NAMES[0]]=0;for(var t=1;t<Define.TEND_NAMES.length;t++)e[Define.TEND_NAMES[t]]=0;return e},e.her_generate=function(){for(var e={},t=1;t<Define.TEND_NAMES.length;t++)Math.random()<=.5?e[Define.TEND_NAMES[t]]=[!0,!1]:e[Define.TEND_NAMES[t]]=[!1,!1];return console.log("randomize her tendency:",e),e},e.my_save=function(){var e="";e=JSON.stringify(Main.pl.MY_TEND),egret.localStorage.setItem("MY_TEND",e)},e.her_save=function(){var e="";e=JSON.stringify(Main.pl.HER_TEND),egret.localStorage.setItem("HER_TEND",e)},e.my_load=function(){var e="";if(e=egret.localStorage.getItem("MY_TEND")){var t=JSON.parse(e);return t}return null},e.her_load=function(){var e="";if(e=egret.localStorage.getItem("HER_TEND")){var t=JSON.parse(e);return t}return null},e.my_change=function(e,t){Main.pl.MY_TEND[e]+=t,console.log("tendency change:"+e+"+"+t),this.my_save()},e.her_rnd_unlock=function(){var e=this.get_her_array(!0);if(e){var t=GameUtils.choice(e),n=t.substr(0,t.length-1);return Main.pl.HER_TEND[n][1]=!0,console.log("tendency unlock:"+n),Main.msg+=Define.MSG_NEW_TEND_UNLOCKED+Define.MSG_SUFFIX,t}console.log("all tendency unlocked!")},e.init=function(){Main.pl.MY_TEND=this.my_generate(),Main.pl.HER_TEND=this.her_generate(),this.her_rnd_unlock(),this.my_save(),this.her_save()},e.load_all=function(){Main.pl.MY_TEND=this.my_load(),Main.pl.HER_TEND=this.her_load()},e.to_EXP=function(){for(var e=0,t=Main.pl.MY_TEND,n=Main.pl.HER_TEND,i=1;i<Define.TEND_NAMES.length;i++){var r=Define.TEND_NAMES[i];n[r][0]?e+=t[r]:e-=t[r]}return e*Define.EXP_PER_TEND},e.get_her_array=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=[],i=!0;for(var r in Main.pl.HER_TEND)i=Main.pl.HER_TEND[r][1],(0==e&&0==t||e&&0==i||t&&1==i)&&(Main.pl.HER_TEND[r][0]?n.push(r+"+"):n.push(r+"-"));return n},e.show_her_tends=function(){for(var e="",t=this.get_her_array(!1,!0),n=this.get_her_array(!0),i=0,r=t.length;r>i;i++)e+=Define.TEND_STR+Main.cfg_tend[t[i]].name+"\n";for(var i=0,r=n.length;r>i;i++)e+=Define.UNLOCK_TEND_STR+"\n";return e},e}();__reflect(Tendency.prototype,"Tendency");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,i){function r(e){t.call(i,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(i))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(i,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var _=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(i,generateJSON.paths[e])},this):RES.getResByUrl(_,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(i,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var UI_InputName=function(e){function t(){var t=e.call(this)||this;return t.once(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/ui_pages/NameInput.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){this.ebtn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkInputName,this),Main.pl.NAME&&(this.eedtext_name.text=Main.pl.NAME),this.ebtn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.exitCurUI,this),this.erect_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.exitCurUI,this)},t.prototype.checkInputName=function(){var e=GameUtils.get_char_length(this.eedtext_name.text);0==e?this.eedtext_name.text=Define.INIT_NAME:e>12?(this.elabel_error.visible=!0,this.elabel_error.text=Define.ERR_NAME_TOO_LONG):(Main.pl.NAME=this.eedtext_name.text,Main.msg+=Define.MSG_NAME_CHANGED_TO+(""+Main.pl.NAME)+Define.MSG_SUFFIX,Game.save(),this.dispatchEventWith("EVT_COMPLETE"))},t.prototype.exitCurUI=function(){this.parent&&this.parent.removeChild(this)},t}(eui.Component);__reflect(UI_InputName.prototype,"UI_InputName");var UI_Main=function(e){function t(){var t=e.call(this)||this;return t.once(eui.UIEvent.COMPLETE,t.toggle_ui,t),t.skinName="resource/ui_pages/MainPage.exml",t}return __extends(t,e),t.prototype.start_game=function(e){var t=this,n=new Date;Game.init(n);var i=new UI_Story(GameUtils.get_story_key("init"));this.addChild(i),i.once("EVT_COMPLETE",function(){i.parent.removeChild(i),Main.msg=Define.MSG_CONNECT_OK,t.toggle_ui()},this)},t.prototype.update=function(e){Main.msg=GameUtils.get_console_text(Main.msg);var t=new Date;Game["continue"](t),this.refresh(!0,!1)},t.prototype.refresh=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!0),Player.is_alive()){if(!t){var n=new Date,i=new Date(Main.pl.BORN_TIME),r=n.getTime()-i.getTime(),a=GameUtils.my_parse_time(r);Main.msg+=Define.MSG_CONNECTED_ALREADY+a+"\n"}Player.is_dying()?this.event_dying():Player.is_weak()?this.event_weak(e):(GameUtils.setAnim0(this.anim_hp_too_low),GameUtils.setAnim0(this.anim_mon_too_much))}else this.toggle_ui();this.lb_name.text=Main.pl.NAME,this.lb_HP_value.text=GameUtils.intstr(Main.pl.HP),this.pb_HP.value=parseInt(this.lb_HP_value.text),this.pb_HP.maximum=Math.max(Main.cfg_prop.HP.max_value,this.pb_HP.value),this.lb_MON_value.text=GameUtils.intstr(Main.pl.MON),this.pb_MON.value=parseInt(this.lb_MON_value.text),this.pb_MON.maximum=Math.max(Main.cfg_prop.MON.max_value,this.pb_MON.value),this.lb_GOLD_value.text=GameUtils.intstr(Main.pl.GOLD),this.lb_EXP_value.text=GameUtils.floatstr(Tendency.to_EXP(),1),this.lb_DIS_value.text=GameUtils.intstr(Main.pl.DISTANCE),this.lb_msg.text=GameUtils.get_console_text(Main.msg)},t.prototype.toggle_ui=function(){this.g_alive.visible=Player.is_alive(),this.g_die.visible=!this.g_alive.visible,this.btn_sys.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSystem,this),Player.is_alive()?(GameUtils.setLoopAnim(this.anim_ring_loop),this.btn_update.addEventListener(egret.TouchEvent.TOUCH_TAP,this.update,this),this.btn_HP_skill.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skill_hp,this),this.btn_MON_skill.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skill_mon,this),this.btn_GOLD_skill.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skill_gold,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.open_tip,this),this.img_name_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.show_props,this),this.refresh(!1,!1)):this.btn_born.addEventListener(egret.TouchEvent.TOUCH_TAP,this.start_game,this),this.fix_story()},t.prototype.skill_hp=function(){Skill.feed();this.refresh()},t.prototype.skill_mon=function(){Skill.clean();this.refresh()},t.prototype.skill_gold=function(){var e=Skill.say();1==e&&this.rnd_story(),this.refresh()},t.prototype.show_props=function(){var e=this,t=new UI_Props;this.addChild(t),t.once("EVT_COMPLETE",function(){t.parent.removeChild(t),e.refresh()},this)},t.prototype.openSystem=function(){var e=new UI_System;this.addChild(e),e.once("EVT_COMPLETE",function(){e.parent.removeChild(e)},this)},t.prototype.rnd_blah=function(){var e=GameUtils.choice(Tendency.get_her_array()),t=GameUtils.choice(Main.cfg_tend[e].blahs);Main.msg+=t+"\n",this.refresh()},t.prototype.rnd_story=function(){var e=this,t=GameUtils.get_story_key("!r");if(t){var n=new UI_Story(t);this.addChild(n),n.once("EVT_COMPLETE",function(){n.parent.removeChild(n),e.refresh()},this)}},t.prototype.fix_story=function(){var e=this,t=GameUtils.get_story_key("!f");if(t){console.log("fix story:"+t);var n=new UI_Story(t);this.addChild(n),n.once("EVT_COMPLETE",function(){n.parent.removeChild(n),e.refresh()},this)}},t.prototype.event_weak=function(e){if(void 0===e&&(e=!1),Player.hp_too_low()?(GameUtils.setLoopAnim(this.anim_hp_too_low),Main.msg+=Define.MSG_HP_TOO_LOW):GameUtils.setAnim0(this.anim_hp_too_low),Player.mon_too_much()?(GameUtils.setLoopAnim(this.anim_mon_too_much),Main.msg+=Define.MSG_MON_TOO_MUCH):GameUtils.setAnim0(this.anim_mon_too_much),!e){var t=new UI_Story(GameUtils.get_story_key("weak"));this.addChild(t),t.once("EVT_COMPLETE",function(){t.parent.removeChild(t)},this)}},t.prototype.event_dying=function(){var e=new UI_Story(GameUtils.get_story_key("die"));this.addChild(e),e.once("EVT_COMPLETE",function(){e.parent.removeChild(e),Main.msg+=Define.MSG_ALMOST_DISCONNECTED,Main.pl.STATUS=PLAYER_STATUS.DIED;var t=new Date;Game.make_history(t),Game.save()},this),Main.msg+=Define.MSG_DISCONNECTED,this.anim_ring_loop.stop()},t.prototype.open_tip=function(e){var t="";switch(e.target){case this.img_HP_frame:t=Main.cfg_prop.HP.tip,t+=Main.cfg_skill.FEED.tip;break;case this.img_MON_frame:t=Main.cfg_prop.MON.tip,t+=Main.cfg_skill.CLEAN.tip;break;case this.img_EXP_frame:t=Main.cfg_prop.EXP.tip,t+=Main.cfg_skill.SAY.tip;break;case this.img_GOLD_frame:t=Main.cfg_prop.GOLD.tip;break;case this.img_screen_frame:return void this.rnd_blah();case this.debug_reset:return Main.msg+=JSON.stringify(Main.pl.HER_TEND)+Define.MSG_SUFFIX,Main.msg+=JSON.stringify(Main.pl.MY_TEND)+Define.MSG_SUFFIX,void this.refresh();case this.debug_hour_past:return Game.time_pass_event(864e5),void console.log("one day passed");default:return}this.lb_tip_text.text=t,this.g_tip.y=e.target.parent.y+80,this.g_tip.visible=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close_tip,this)},t.prototype.close_tip=function(){this.g_tip.visible=!1,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.close_tip,this)},t}(eui.Component);__reflect(UI_Main.prototype,"UI_Main");var UI_Props=function(e){function t(){var t=e.call(this)||this;return t.once(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/ui_pages/Props.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){this.r_mask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.exitCurUI,this),this.lb_name.text=Main.pl.NAME,this.lb_tends.text=Tendency.show_her_tends(),this.btn_rename.addEventListener(egret.TouchEvent.TOUCH_TAP,this.show_rename,this)},t.prototype.show_rename=function(){var e=this,t=new UI_InputName;this.addChild(t),t.once("EVT_COMPLETE",function(){t.parent.removeChild(t),e.dispatchEventWith("EVT_COMPLETE")},this)},t.prototype.exitCurUI=function(){this.parent&&this.parent.removeChild(this)},t}(eui.Component);__reflect(UI_Props.prototype,"UI_Props");var UI_Story=function(e){function t(t){var n=e.call(this)||this;return n.history_p_now=0,n.key=t,n.once(eui.UIEvent.COMPLETE,n.uiCompHandler,n),n.skinName="resource/ui_pages/Story.exml",n}return __extends(t,e),t.prototype.uiCompHandler=function(){if(Player.can_skip()){var e=Main.cfg_story[this.key];e.can_skip&&(this.btn_skip.visible=!0,this.btn_skip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skip_story,this))}if("history"==this.key)return void this.show_history();this.anim_drop.stop();var t=Main.cfg_story[String(this.key)];if(this.lb_text.text=t.text.replace("!name",Main.pl.NAME),t.tend){var n=Tendency.get_her_array(!1,!0);for(var i in n)if(0==n[i].indexOf(t.tend)){this.lb_tend.text=Main.pl.NAME+Define.TEND_STR+Main.cfg_tend[n[i]].name,this.lb_tend.visible=!0;break}}else this.lb_tend.visible=!1;t.ok_text?(this.btn_yes.visible=!1,this.btn_no.visible=!1,this.btn_ok.visible=!0,this.btn_ok.label=t.ok_text,this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,this.select_ok,this)):t.yes_text&&(this.btn_yes.visible=!0,this.btn_no.visible=!0,this.btn_ok.visible=!1,this.btn_yes.label=t.yes_text,this.btn_no.label=t.no_text,this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,this.select_yes,this),this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,this.select_no,this)),this.anim_drop.play(),GameUtils.setLoopAnim(this.anim_loop);var r=new egret.Timer(5e3,1);r.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timer_complete,this),r.start()},t.prototype.timer_complete=function(){GameUtils.setAnim0(this.anim_loop)},t.prototype.select_ok=function(){var e=Main.cfg_story[String(this.key)],t=e.ok_evt;e.extra?this.do_extra(e.extra,t):this.next_evt(t)},t.prototype.select_yes=function(){var e=Main.cfg_story[String(this.key)],t=e.yes_evt;e.extra?this.do_extra(e.extra,t):this.next_evt(t)},t.prototype.select_no=function(){var e=Main.cfg_story[String(this.key)],t=e.no_evt;e.extra?this.do_extra(e.extra,t):this.next_evt(t)},t.prototype.exitCurUI=function(){this.parent&&this.dispatchEventWith("EVT_COMPLETE")},t.prototype.skip_story=function(){Main.pl.GOLD-=Define.SKIP_GOLD,Game.save(),this.exitCurUI()},t.prototype.show_history=function(){this.history_texts=Game.history_textflow(),this.history_p_now=0,this.history_texts&&this.next_history()},t.prototype.next_history=function(){var e=Main.cfg_story.history;this.anim_drop.stop(),this.lb_text.text=this.history_texts[this.history_p_now],this.anim_drop.play(),GameUtils.setLoopAnim(this.anim_loop);var t=new egret.Timer(5e3,1);t.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timer_complete,this),t.start(),this.history_p_now+=1;var n=this.history_texts.length;this.history_p_now>=n?(this.btn_yes.visible=!1,this.btn_no.visible=!1,this.btn_ok.visible=!0,this.btn_ok.label=e.ok_text,this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,this.exitCurUI,this)):(this.btn_yes.visible=!0,this.btn_no.visible=!0,this.btn_ok.visible=!1,this.btn_yes.label=e.yes_text,this.btn_no.label=e.no_text,this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,this.next_history,this),this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,this.exitCurUI,this))},t.prototype.do_extra=function(e,t){var n=this;if(0==e.indexOf("NameInput")){var i=new UI_InputName;this.addChild(i),i.once("EVT_COMPLETE",function(){i.parent.removeChild(i),n.next_evt(t)},this)}else if(0==e.indexOf("RndTendUnlock")){var r=Tendency.her_rnd_unlock();r&&this.next_evt(r)}else if(0==e.indexOf("!")){var a=e.substr(1,2),o=e.substr(3,1),s=0;"+"==o?s=1:"-"==o&&(s=-1),Tendency.my_change(a,s),this.next_evt(t)}},t.prototype.next_evt=function(e){e&&""!=e?Main.cfg_story.hasOwnProperty(e)&&(this.key=e,this.uiCompHandler()):this.exitCurUI()},t}(eui.Component);__reflect(UI_Story.prototype,"UI_Story");var UI_System=function(e){function t(){var t=e.call(this)||this;return t.once(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/ui_pages/System.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){this.r_mask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.exitCurUI,this),this.btn_history.addEventListener(egret.TouchEvent.TOUCH_TAP,this.show_history,this),this.btn_credits.addEventListener(egret.TouchEvent.TOUCH_TAP,this.show_credits,this),this.btn_link.addEventListener(egret.TouchEvent.TOUCH_TAP,this.link,this)},t.prototype.exitCurUI=function(){this.parent&&this.parent.removeChild(this)},t.prototype.show_history=function(){var e=this;if(Game.load_history()){var t=GameUtils.get_story_key("history");if(t){var n=new UI_Story(t);this.addChild(n),n.once("EVT_COMPLETE",function(){n.parent.removeChild(n),e.dispatchEventWith("EVT_COMPLETE")},this)}}else this.lb_error_tip.text=Define.ERR_NO_HISTORY},t.prototype.show_credits=function(){var e=this,t=GameUtils.get_story_key("credits");if(t){var n=new UI_Story(t);this.addChild(n),n.once("EVT_COMPLETE",function(){n.parent.removeChild(n),e.dispatchEventWith("EVT_COMPLETE")},this)}},t.prototype.link=function(){window.open(Define.LINK_MAIN_PAGE),this.exitCurUI()},t}(eui.Component);__reflect(UI_System.prototype,"UI_System");